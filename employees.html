<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employees - Indian Payroll System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">Indian Payroll System</div>
        <ul class="nav-menu">
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="employees.html" class="active">Employees</a></li>
            <li><a href="attendance.html">Attendance</a></li>
            <li><a href="salary.html">Salary/Payroll</a></li>
            <li><a href="leaves.html">Leave Management</a></li>
            <li><a href="loans.html">Loans & Advances</a></li>
            <li><a href="reimbursements.html">Reimbursements</a></li>
            <li><a href="#" onclick="logout()">Logout</a></li>
        </ul>
        <div class="user-info">
            <span id="userDisplay"></span>
        </div>
    </nav>

    <div class="container">
        <h1>Employee Management</h1>
        
        <div class="action-bar">
            <button onclick="showAddEmployeeForm()" class="btn-primary">Add New Employee</button>
        </div>

        <!-- Enhanced Employee Form with Additional Fields -->
        <div id="employeeForm" class="form-section" style="display: none;">
            <h2 id="formTitle">Add New Employee</h2>
            <form id="empForm">
                <input type="hidden" id="empId">
                
                <!-- Personal Information -->
                <h3>Personal Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="empName">Full Name *</label>
                        <input type="text" id="empName" required>
                    </div>
                    <div class="form-group">
                        <label for="empCode">Employee Code *</label>
                        <input type="text" id="empCode" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="fatherName">Father's Name</label>
                        <input type="text" id="fatherName">
                    </div>
                    <div class="form-group">
                        <label for="dob">Date of Birth</label>
                        <input type="date" id="dob">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="gender">Gender</label>
                        <select id="gender">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="maritalStatus">Marital Status</label>
                        <select id="maritalStatus">
                            <option value="Single">Single</option>
                            <option value="Married">Married</option>
                            <option value="Divorced">Divorced</option>
                            <option value="Widowed">Widowed</option>
                        </select>
                    </div>
                </div>

                <!-- Contact Information -->
                <h3>Contact Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="mobile">Mobile Number</label>
                        <input type="tel" id="mobile" pattern="[0-9]{10}">
                    </div>
                    <div class="form-group">
                        <label for="email">Email ID</label>
                        <input type="email" id="email">
                    </div>
                </div>
                <div class="form-group">
                    <label for="address">Current Address</label>
                    <textarea id="address" rows="2"></textarea>
                </div>

                <!-- Statutory Information -->
                <h3>Statutory Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="pan">PAN Number</label>
                        <input type="text" id="pan" pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" placeholder="ABCDE1234F">
                    </div>
                    <div class="form-group">
                        <label for="aadhaar">Aadhaar Number</label>
                        <input type="text" id="aadhaar" pattern="[0-9]{12}" placeholder="123456789012">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="uan">UAN (PF)</label>
                        <input type="text" id="uan" pattern="[0-9]{12}">
                    </div>
                    <div class="form-group">
                        <label for="esiNo">ESI Number</label>
                        <input type="text" id="esiNo">
                    </div>
                </div>

                <!-- Employment Details -->
                <h3>Employment Details</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="department">Department *</label>
                        <select id="department">
                            <option value="IT">IT</option>
                            <option value="HR">HR</option>
                            <option value="Finance">Finance</option>
                            <option value="Sales">Sales</option>
                            <option value="Operations">Operations</option>
                            <option value="Administration">Administration</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="designation">Designation *</label>
                        <input type="text" id="designation" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="grade">Grade/Level</label>
                        <select id="grade">
                            <option value="G1">G1 - Junior</option>
                            <option value="G2">G2 - Associate</option>
                            <option value="G3">G3 - Senior</option>
                            <option value="G4">G4 - Lead</option>
                            <option value="G5">G5 - Manager</option>
                            <option value="G6">G6 - Senior Manager</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="empType">Employee Type</label>
                        <select id="empType">
                            <option value="Permanent">Permanent</option>
                            <option value="Contract">Contract</option>
                            <option value="Probation">Probation</option>
                            <option value="Intern">Intern</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="joiningDate">Joining Date *</label>
                        <input type="date" id="joiningDate" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmationDate">Confirmation Date</label>
                        <input type="date" id="confirmationDate">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="reportingManager">Reporting Manager</label>
                        <select id="reportingManager">
                            <option value="">Select Manager</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="location">Location</label>
                        <input type="text" id="location" placeholder="Mumbai, Delhi, Bangalore">
                    </div>
                </div>

                <!-- Salary Information -->
                <h3>Salary Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="salary">Basic Salary (₹) *</label>
                        <input type="number" id="salary" required>
                    </div>
                    <div class="form-group">
                        <label for="ctc">CTC (₹)</label>
                        <input type="number" id="ctc">
                    </div>
                </div>

                <!-- Bank Details -->
                <h3>Bank Details</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bankName">Bank Name</label>
                        <input type="text" id="bankName">
                    </div>
                    <div class="form-group">
                        <label for="accountNumber">Account Number</label>
                        <input type="text" id="accountNumber">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="ifscCode">IFSC Code</label>
                        <input type="text" id="ifscCode" pattern="[A-Z]{4}[0-9]{7}">
                    </div>
                    <div class="form-group">
                        <label for="branchName">Branch Name</label>
                        <input type="text" id="branchName">
                    </div>
                </div>

                <div class="form-buttons">
                    <button type="submit" class="btn-primary">Save Employee</button>
                    <button type="button" onclick="hideEmployeeForm()" class="btn-secondary">Cancel</button>
                </div>
            </form>
        </div>

        <!-- Employee List -->
        <div class="table-section">
            <h2>Employee List</h2>
            <table id="employeeTable">
                <thead>
                    <tr>
                        <th>Emp Code</th>
                        <th>Name</th>
                        <th>Department</th>
                        <th>Designation</th>
                        <th>Grade</th>
                        <th>Type</th>
                        <th>Mobile</th>
                        <th>Salary (₹)</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="employeeList">
                    <!-- Employees will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        // Check if user is logged in
        checkAuth();

        let employees = JSON.parse(localStorage.getItem('employees') || '[]');
        let editingId = null;

        function loadEmployees() {
            const tbody = document.getElementById('employeeList');
            tbody.innerHTML = '';
            
            employees.forEach(emp => {
                const row = tbody.insertRow();
                const status = getEmployeeStatus(emp);
                row.innerHTML = `
                    <td>${emp.empCode}</td>
                    <td>${emp.name}</td>
                    <td>${emp.department}</td>
                    <td>${emp.designation}</td>
                    <td>${emp.grade || 'N/A'}</td>
                    <td>${emp.empType || 'Permanent'}</td>
                    <td>${emp.mobile || 'N/A'}</td>
                    <td>₹${emp.salary.toLocaleString('en-IN')}</td>
                    <td><span class="status-badge status-${status.toLowerCase()}">${status}</span></td>
                    <td>
                        <button onclick="viewEmployee(${emp.id})" class="btn-small">View</button>
                        <button onclick="editEmployee(${emp.id})" class="btn-small">Edit</button>
                        <button onclick="deleteEmployee(${emp.id})" class="btn-small btn-danger">Delete</button>
                    </td>
                `;
            });
        }

        function showAddEmployeeForm() {
            document.getElementById('employeeForm').style.display = 'block';
            document.getElementById('formTitle').textContent = 'Add New Employee';
            document.getElementById('empForm').reset();
            editingId = null;
        }

        function hideEmployeeForm() {
            document.getElementById('employeeForm').style.display = 'none';
            editingId = null;
        }

        function editEmployee(id) {
            const emp = employees.find(e => e.id === id);
            if (emp) {
                document.getElementById('employeeForm').style.display = 'block';
                document.getElementById('formTitle').textContent = 'Edit Employee';
                document.getElementById('empId').value = emp.id;
                document.getElementById('empName').value = emp.name || '';
                document.getElementById('empCode').value = emp.empCode || '';
                document.getElementById('fatherName').value = emp.fatherName || '';
                document.getElementById('dob').value = emp.dob || '';
                document.getElementById('gender').value = emp.gender || 'Male';
                document.getElementById('maritalStatus').value = emp.maritalStatus || 'Single';
                document.getElementById('mobile').value = emp.mobile || '';
                document.getElementById('email').value = emp.email || '';
                document.getElementById('address').value = emp.address || '';
                document.getElementById('pan').value = emp.pan || '';
                document.getElementById('aadhaar').value = emp.aadhaar || '';
                document.getElementById('uan').value = emp.uan || '';
                document.getElementById('esiNo').value = emp.esiNo || '';
                document.getElementById('department').value = emp.department || '';
                document.getElementById('designation').value = emp.designation || '';
                document.getElementById('grade').value = emp.grade || 'G1';
                document.getElementById('empType').value = emp.empType || 'Permanent';
                document.getElementById('joiningDate').value = emp.joiningDate || '';
                document.getElementById('confirmationDate').value = emp.confirmationDate || '';
                document.getElementById('reportingManager').value = emp.reportingManager || '';
                document.getElementById('location').value = emp.location || '';
                document.getElementById('salary').value = emp.salary || 0;
                document.getElementById('ctc').value = emp.ctc || 0;
                document.getElementById('bankName').value = emp.bankName || '';
                document.getElementById('accountNumber').value = emp.accountNumber || '';
                document.getElementById('ifscCode').value = emp.ifscCode || '';
                document.getElementById('branchName').value = emp.branchName || '';
                editingId = id;
            }
        }

        function deleteEmployee(id) {
            if (confirm('Are you sure you want to delete this employee?')) {
                employees = employees.filter(e => e.id !== id);
                localStorage.setItem('employees', JSON.stringify(employees));
                loadEmployees();
            }
        }

        document.getElementById('empForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const empData = {
                id: editingId || Date.now(),
                name: document.getElementById('empName').value,
                empCode: document.getElementById('empCode').value,
                fatherName: document.getElementById('fatherName').value,
                dob: document.getElementById('dob').value,
                gender: document.getElementById('gender').value,
                maritalStatus: document.getElementById('maritalStatus').value,
                mobile: document.getElementById('mobile').value,
                email: document.getElementById('email').value,
                address: document.getElementById('address').value,
                pan: document.getElementById('pan').value,
                aadhaar: document.getElementById('aadhaar').value,
                uan: document.getElementById('uan').value,
                esiNo: document.getElementById('esiNo').value,
                department: document.getElementById('department').value,
                designation: document.getElementById('designation').value,
                grade: document.getElementById('grade').value,
                empType: document.getElementById('empType').value,
                joiningDate: document.getElementById('joiningDate').value,
                confirmationDate: document.getElementById('confirmationDate').value,
                reportingManager: document.getElementById('reportingManager').value,
                location: document.getElementById('location').value,
                salary: parseInt(document.getElementById('salary').value),
                ctc: parseInt(document.getElementById('ctc').value) || 0,
                bankName: document.getElementById('bankName').value,
                accountNumber: document.getElementById('accountNumber').value,
                ifscCode: document.getElementById('ifscCode').value,
                branchName: document.getElementById('branchName').value,
                status: 'Active',
                createdDate: editingId ? employees.find(e => e.id === editingId).createdDate : new Date().toISOString(),
                modifiedDate: new Date().toISOString()
            };

            if (editingId) {
                const index = employees.findIndex(e => e.id === editingId);
                employees[index] = empData;
            } else {
                employees.push(empData);
            }

            localStorage.setItem('employees', JSON.stringify(employees));
            loadEmployees();
            hideEmployeeForm();
        });

        // Additional functions
        function getEmployeeStatus(emp) {
            const today = new Date();
            const joiningDate = new Date(emp.joiningDate);
            const confirmationDate = emp.confirmationDate ? new Date(emp.confirmationDate) : null;
            
            if (emp.status === 'Resigned') return 'Resigned';
            if (emp.empType === 'Probation' && (!confirmationDate || confirmationDate > today)) {
                return 'Probation';
            }
            return 'Active';
        }

        function viewEmployee(id) {
            const emp = employees.find(e => e.id === id);
            if (emp) {
                // Create a simple view modal
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'block';
                modal.innerHTML = `
                    <div class="modal-content">
                        <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                        <h2>Employee Details</h2>
                        <div class="employee-details">
                            <p><strong>Employee Code:</strong> ${emp.empCode}</p>
                            <p><strong>Name:</strong> ${emp.name}</p>
                            <p><strong>Father's Name:</strong> ${emp.fatherName || 'N/A'}</p>
                            <p><strong>Department:</strong> ${emp.department}</p>
                            <p><strong>Designation:</strong> ${emp.designation}</p>
                            <p><strong>Grade:</strong> ${emp.grade || 'N/A'}</p>
                            <p><strong>Mobile:</strong> ${emp.mobile || 'N/A'}</p>
                            <p><strong>Email:</strong> ${emp.email || 'N/A'}</p>
                            <p><strong>PAN:</strong> ${emp.pan || 'N/A'}</p>
                            <p><strong>UAN:</strong> ${emp.uan || 'N/A'}</p>
                            <p><strong>Basic Salary:</strong> ₹${emp.salary ? emp.salary.toLocaleString('en-IN') : 'N/A'}</p>
                            <p><strong>Joining Date:</strong> ${emp.joiningDate}</p>
                            <p><strong>Status:</strong> ${getEmployeeStatus(emp)}</p>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" class="btn-secondary">Close</button>
                    </div>
                `;
                document.body.appendChild(modal);
            }
        }

        function loadReportingManagers() {
            const select = document.getElementById('reportingManager');
            const currentId = document.getElementById('empId').value;
            
            select.innerHTML = '<option value="">Select Manager</option>';
            employees.forEach(emp => {
                if (emp.id != currentId) { // Don't show self as reporting manager
                    select.innerHTML += `<option value="${emp.id}">${emp.name} (${emp.empCode})</option>`;
                }
            });
        }

        // Load employees on page load
        loadEmployees();
        
        // Load reporting managers when showing form
        document.getElementById('employeeForm').addEventListener('DOMContentLoaded', loadReportingManagers);
    </script>
</body>
</html>